<div class="panel panel-primary listBook">
  <div class="panel-heading">
    <%= t('.list_book')%>
  </div>
  <div class="panel-body">
    <%= form_tag destroy_multiple_books_path , :method => :delete do %>
    <% if current_user.has_role? :admin %>
      <%= render 'shared/action_button' %>
    <% end %>
    <input id="categoy_name" type="hidden">
    <table class="table table-striped table-hover table-responsive table-bordered bookTable display" data-source="<%= books_url(format: "json") %>">
      <thead>
        <tr>
          <th><%= t('.author')%></th>
          <th><%= t('.title')%></th>
          <th><%= t('.year')%></th>
          <th><%= t('.category')%></th>
          <% if current_user.has_role? :admin %>
            <th><%= t('.select')%></th>
            <th></th>
          <% end %>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <% end %>
  </div>
</div>

<% if current_user.has_role? :admin %>
  <script>
    function renderCategory(data){
        return '<span class="filter_category_name">'+data+'</span>';
      }
      click_filter = function(){
        $('.filter_category_name').click(function(){
          category_name = $(this).text();
          if(category_name != ""){
            $("#categoy_name").val(categoy_name);
            $(".bookTable").dataTable().fnReloadAjax();
          }
        })
      }
      $(".bookTable").dataTable({
        info: false,
        bProcessing: true,
        bServerSide: true,
        sAjaxSource: $('.bookTable').data('source'),
        bLengthChange: false,
        aaSorting: [[1, 'asc']],
        aoColumns: [
            {"sWidth": "20%", "bSortable": false },
            null,
            {"sWidth": "10%", "bSearchable": false},
            {"sWidth": "20%", "bSortable": false , "bSearchable": false, "mRender": renderCategory},
            { "sWidth": "8%", "sClass": "alignCenter", "bSortable": false, "bSearchable": false },
            { "sWidth": "8%", "sClass": "alignCenter", "bSortable": false, "bSearchable": false }
          ],
        "fnServerParams": function ( aoData ) {
          aoData.push( { "name": "category_name", "value": $('#categoy_name').val() } );
        }
        });
      
  </script>
  <% else %>
  <script >
    $(".bookTable").dataTable({
      info: false,
      bProcessing: true,
      bServerSide: true,
      sAjaxSource: $('.bookTable').data('source'),
      bLengthChange: false,
      aaSorting: [[1, 'asc']],
      aoColumns: [
          {"sWidth": "20%", "bSortable": false },
          null,
          {"sWidth": "10%", "bSearchable": false},
          {"sWidth": "20%", "bSortable": false , "bSearchable": false}
        ]
      });
  </script>
<% end %>